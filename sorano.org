#+TITLE: Sorano Project

:var soranoSudo = 

* Setup

** Install docker on sorano.home
   
   Followed this [[https://docs.docker.com/engine/installation/debian/][Documentation]]

   #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano
     apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
     echo 'deb https://apt.dockerproject.org/repo debian-jessy main' >> /etc/apt/sources.list
     apt-get update
     apt-get install docker-engine
     systemctl enable docker
   #+END_SRC

** Setup salt master docker

*** build the salt master
      #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/soranoProject/docker/salt_master :results raw
      docker build -t vercapi/salt_master .
      #+END_SRC
      
      #+RESULTS:
      Sending build context to Docker daemon 2.048 kBSending build context to Docker daemon 2.048 kB
      Step 1 : FROM debian:jessie
      ---> 91bac885982d
      Step 2 : RUN apt-get update && apt-get install -y wget
      ---> Using cache
      ---> 2fda7ad65f9d
      Step 3 : RUN wget -O - https://repo.saltstack.com/apt/debian/latest/SALTSTACK-GPG-KEY.pub | apt-key add -
      ---> Using cache
      ---> 7b42cadccb6f
      Step 4 : RUN echo deb http://repo.saltstack.com/apt/debian/latest jessie main >> /etc/apt/sources.list
      ---> Using cache
      ---> a13b8e49d623
      Step 5 : RUN apt-get update && apt-get install -y salt-master
      ---> Using cache
      ---> 740e7725090a
      Step 6 : EXPOSE 4505 4506
      ---> Using cache
      ---> 1ee7f675dece
      Step 7 : CMD salt-master
      ---> Using cache
      ---> 044a47aeba10
      Successfully built 044a47aeba10

*** Starting the saltmaster manually
    
    Start as daemon
    #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/
      docker run -id -h sorano.salt -p 4505:4505 -p 4506:4506 --name saltmaster vercapi/salt_master
    #+END_SRC

    #+RESULTS:
    : 886e92a46d469a7c905679670943e70b6594723e7220124bf15f7653eacf6806
    
    Open connection to salt master to see if it is running
    #+BEGIN_SRC sh /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/
    nc -v 127.0.0.1 4506 
    #+END_SRC

    Check running dockers
    #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/
    docker ps
    #+END_SRC

    Manually stop the maching
    #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/
    docker stop saltmaster
    #+END_SRC

    Attach to running machine
    #+BEGIN_SRC sh :dir /ssh:sorano@192.168.1.2|sudo:192.168.1.2:/home/sorano/
    docker exec -it saltmaster bash
    #+END_SRC

*** TODO Set up automatic start
